<!doctype html><html><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>OCI Image Support Comes to Open Source Docker Registry - Open Container Initiative</title><meta name=author content="map[name:Open Container Initiative tag:oci]"><link href="https://fonts.googleapis.com/css2?family=Lekton:ital,wght@0,400;0,700;1,400&family=Open+Sans:ital,wght@0,400;0,700;1,400;1,700&display=swap" rel=stylesheet><link rel=stylesheet href=/css/styles.min.338fe0dbba89c3f6977ce2d01697f804f1e072d930d628d7ecb4e790232b7c15.css integrity="sha256-M4/g27qJw/aXfOLQFpf4BPHgctkw1ijX7LTnkCMrfBU="><meta name=generator content="Hugo 0.68.3"></head><body class="flex flex-col min-h-screen bg-lightgray"><header class="sticky top-0 w-full header-shadow"><div class="flex justify-left bg-darkgray"><div class="flex p-1"><a href=https://www.linuxfoundation.org/projects target=_blank><img src=/img/logos/logo_lf_projects.svg class=h-4></a></div></div><nav class="flex flex-wrap items-center justify-between bg-white xs:flex-col sm:flex-col md:flex-col lg:flex-row"><div class="flex-none p-1 md:items-center sm:w-auto md:w-auto"><a href=https://opencontainers.org/ class="flex items-center"><img src=/img/logos/OCI-logo.svg class=h-10></a></div><nav class="flex flex-wrap items-center justify-between pr-5 sm:w-auto md:w-auto"><input id=nav-toggle type=checkbox class=hidden>
<label id=show-button for=nav-toggle class="flex items-center block text-gray-500 sm:hidden hover:text-blue-500"><svg class="w-4 h-4 fill-current" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><title>Menu Open</title><path d="M0 3h20v2H0V3zm0 6h20v2H0V9zm0 6h20v2H0V0z" /></svg></label><label id=hide-button for=nav-toggle class="flex items-center hidden p-2 text-gray-700 hover:text-blue-500"><svg class="w-4 h-4 fill-current" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><title>Menu Close</title><polygon points="11 9 22 9 22 11 11 11 11 22 9 22 9 11 -2 11 -2 9 9 9 9 -2 11 -2" transform="rotate(45 10 10)" /></svg></label><ul id=nav-menu class="items-center justify-end flex-grow hidden w-full mt-2 md:flex-row sm:flex-row sm:flex sm:w-auto sm:block list-reset sm:mt-0"><li class="parent-menu-item sm:self-start"><a class="inline-block text-gray-500 sm:px-2 hover:text-lightpurple lekton navbar-item" href=#>About
<ion-icon name=chevron-down-sharp class=align-middle></ion-icon></a><div class="p-2 child-menu"><ul><li><a class="inline-block text-gray-500 sm:px-2 hover:text-lightpurple lekton navbar-item" href=/about/overview>About the OCI</a></li><li><a class="inline-block text-gray-500 sm:px-2 hover:text-lightpurple lekton navbar-item" href=https://github.com/opencontainers/tob/blob/master/CHARTER.md target=_blank>Governance
<ion-icon name=trending-up-sharp title="external link"></ion-icon></a></li><li><a class="inline-block text-gray-500 sm:px-2 hover:text-lightpurple lekton navbar-item" href=https://github.com/opencontainers/.github/blob/master/CODE_OF_CONDUCT.md target=_blank>Code of conduct
<ion-icon name=trending-up-sharp title="external link"></ion-icon></a></li><li><a class="inline-block text-gray-500 sm:px-2 hover:text-lightpurple lekton navbar-item" href=/about/tob>Leadership</a></li><li><a class="inline-block text-gray-500 sm:px-2 hover:text-lightpurple lekton navbar-item" href=/about/security-disclosure>Security disclosure</a></li></ul></div></li><li class="parent-menu-item sm:self-start"><a class="inline-block text-gray-500 sm:px-2 hover:text-lightpurple lekton navbar-item" href=#>Specs
<ion-icon name=chevron-down-sharp class=align-middle></ion-icon></a><div class="p-2 child-menu"><ul><li><a class="inline-block text-gray-500 sm:px-2 hover:text-lightpurple lekton navbar-item" href=/specs/distribution-spec/>Distribution spec</a></li></ul></div></li><li class="parent-menu-item sm:self-start"><a class="inline-block text-gray-500 sm:px-2 hover:text-lightpurple lekton navbar-item" href=#>Community
<ion-icon name=chevron-down-sharp class=align-middle></ion-icon></a><div class="p-2 child-menu"><ul><li><a class="inline-block text-gray-500 sm:px-2 hover:text-lightpurple lekton navbar-item" href=/community/overview>Overview</a></li><li><a class="inline-block text-gray-500 sm:px-2 hover:text-lightpurple lekton navbar-item" href=/community/certified>Certification program</a></li></ul></div></li><li class="parent-menu-item sm:self-start"><a class="inline-block text-gray-500 sm:px-2 hover:text-lightpurple lekton navbar-item" href=/join>Join</a></li><li class="parent-menu-item sm:self-start"><a class="inline-block text-gray-500 sm:px-2 hover:text-lightpurple lekton navbar-item" href=/posts/blog>Blog</a></li><li class="parent-menu-item sm:self-start"><a class="inline-block text-gray-500 sm:px-2 hover:text-lightpurple lekton navbar-item" href=#>News
<ion-icon name=chevron-down-sharp class=align-middle></ion-icon></a><div class="p-2 child-menu"><ul><li><a class="inline-block text-gray-500 sm:px-2 hover:text-lightpurple lekton navbar-item" href=/posts/announcements/>Announcements</a></li><li><a class="inline-block text-gray-500 sm:px-2 hover:text-lightpurple lekton navbar-item" href=/posts/news/>In the news</a></li></ul></div></li><li class="parent-menu-item sm:self-start"><a class="inline-block text-gray-500 sm:px-2 hover:text-lightpurple lekton navbar-item" href=/faq>FAQ</a></li><li class="parent-menu-item sm:self-start"><a class="inline-block text-gray-500 sm:px-2 hover:text-lightpurple lekton navbar-item" href=/release-notices>Release notices</a></li><li class="parent-menu-item sm:self-start"><a class="inline-block text-gray-500 sm:px-2 hover:text-lightpurple lekton navbar-item" href=/contact>Contact us</a></li><li class="parent-menu-item sm:self-start"><a href=https://twitter.com/OCI_ORG class=p-2 target=_blank title="follow us on Twitter"><ion-icon name=logo-twitter class=pt-1></ion-icon></a></li></ul></nav></nav></header><main class="container mx-auto"><article class="mt-20 mb-10"><div class="px-10 pt-10 pb-5 single-header"><h1 class="text-3xl font-bold">OCI Image Support Comes to Open Source Docker Registry</h1><p class="pb-5 meta">Thursday, October 11, 2018 by Open Container Initiative</p><div id=sharing><a href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fopencontainers.org%2fposts%2fblog%2f2018-10-11-oci-image-support-comes-to-open-source-docker-registry%2f" class=pl-1 aria-label="share on Facebook"><ion-icon name=logo-facebook></ion-icon></a><a href="http://twitter.com/share?url=https%3a%2f%2fopencontainers.org%2fposts%2fblog%2f2018-10-11-oci-image-support-comes-to-open-source-docker-registry%2f&text=OCI%20Image%20Support%20Comes%20to%20Open%20Source%20Docker%20Registry&via=" class=pl-1 aria-label="share on Twitter"><ion-icon name=logo-twitter></ion-icon></a><a href="http://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fopencontainers.org%2fposts%2fblog%2f2018-10-11-oci-image-support-comes-to-open-source-docker-registry%2f&title=OCI%20Image%20Support%20Comes%20to%20Open%20Source%20Docker%20Registry" onclick="window.open('http://www.linkedin.com/shareArticle?mini=true&url='+encodeURIComponent(document.URL)+'&title='+encodeURIComponent(document.title));return false;" class=pl-1 aria-label="share on LinkedIn"><ion-icon name=logo-linkedin></ion-icon></a></div></div><div class="px-32 py-24 bg-white content"><p>By Phil Estes & Mike Brown</p><p>The Open Container Initiative (OCI) was formed in 2015 as a place to collaborate on the definition of a standard container runtime and image format. By that time, Docker had effectively become the de facto standard for container images, and DockerHub and many other public and private registries were filled with tens of thousands of available container images using the Docker image format.</p><p>Given this state of the world in late 2015, the OCI image specification work began in earnest with a strong group of collaborating independent and vendor-associated participants, using the Docker v2.2 image format as a starting point. Fast forward eighteen months, and by summer of 2017, both the runtime and image specifications reached their <a href=/posts/announcements/2017-07-17-open-container-initiative-oci-releases-v1-0-of-container-standards>intended 1.0 milestone release</a>.</p><p>That release was a great milestone for the OCI community and container ecosystem at large, but the next step beyond declaring victory on any specification is always: adoption! The runtime specification had a head start here. The default reference implementation within the OCI, runc, was already in use by several implementers including the Docker engine by the time the specification was released. For the image specification, tools, and most notably, container image registries would have to adopt the OCI v1.0 image specification specifically for it to be useful to developers and implementers. Many tools existed to operate on Docker’s v2.2 image manifest format already, and these tools would now need to adopt the OCI format.</p><p>This work—enabling OCI images in the core registry used on a daily basis for millions of images—started in 2016 on the <a href=https://github.com/docker/distribution>Docker distribution project</a> long before the specification even reached 1.0. This open source project is probably better known as the registry that backs DockerHub as well as many other public and private registries. Now that this pull request has been merged, we’ll take a few minutes to describe a bit more about the OCI image spec and how the open source registry was modified to support OCI in addition to its native Docker image formats.</p><h2 id=background>Background</h2><p>Container registries today are usually the combination of an <a href=https://docs.docker.com/registry/spec/api/>HTTP API</a> backed by some form of content store, with the content itself delineated by various media types. In the Docker image specification, you have metadata types (like the image’s Docker runtime configuration) as JSON content, combined with references to image layers, usually tarred and compressed binary blobs which are then stored in the backing filesystem along with their requisite media types. For example, in the Docker v2.2 image world, each container image will have a manifest with the media type application/vnd.docker.distribution.manifest.v2+json. A list of image references (to support multi-platform images) is known as a manifest list with media type: application/vnd.docker.distribution.manifest.list.v2+json. An image layer commonly has the media type of application/vnd.docker.image.rootfs.diff.tar.gzip.</p><p>The OCI specification took this <a href=https://docs.docker.com/registry/spec/manifest-v2-2/>v2.2 image specification</a> from Docker as a starting point, but as definitions were changed in small ways during the specification process, each one of the Docker image metadata or layer media types developed into an OCI counterpart. Given these efforts, the resulting official OCI media types include application/vnd.oci.image.manifest.v1+json for the image manifest. Manifest lists have been renamed to “indexes” in OCI v1, giving us the media type: application/vnd.oci.image.index.v1+json. A layer type becomes application/vnd.oci.image.layer.v1.tar+gzip in OCI parlance, and so on.</p><h2 id=implementation>Implementation</h2><p>To add OCI v1 support into the open source distribution project meant handling all the new media types from the OCI specification, and appropriately handling the HTTP API interactions when a client of the registry wants to “speak” in OCI media-types versus the already supported Docker types. If you think of image manifests being the top-most objects in the registry’s world, then effectively the registry was currently supporting three: the original “schema 1” Docker image format; the “schema 2” single image Docker format, and the manifest list multi-platform Docker image format (part of the schema 2.2 definition, but treated as a separate object type). Adding the OCI v1 types would mean supporting OCI v1 manifests and indexes—two additional formats, which would cascade into all the OCI media type references from these high level manifests and indexes.</p><p>The first attempt looked at simply expanding the registry’s handlers for the schema 2 and manifest list types to support OCI v1 manifests and OCI v1 indexes. These two types are quite similar between Docker v2.2 and OCI v1, so it seemed like it might be a quick path to getting support for OCI into the registry codebase. However, over time it became clear that this would not be an optimal path for long-term OCI image support.</p><h2 id=success>Success</h2><p>Finally, the approach presented in <a href=https://github.com/docker/distribution/pull/2076>GitHub pull request #2076</a> –to add specific new handlers to the open source registry for the OCI main image types (v1 manifests and v1 indexes)—was agreed on and in July of 2018 this PR was merged into the docker/distribution project. This PR adds new handlers for the OCI types as well as new tests, validation code, and integration that crosses various core sections of the registry codebase. As with most PRs that add significant capability, it was not an easy task, and Mike Brown from IBM persisted on the project for over a year before working out all the requested issues, reviews, and bugs found during testing and validation of the OCI support!</p><h2 id=summary>Summary</h2><p>Interested parties can try out the recently available <a href=https://github.com/docker/distribution/releases/tag/v2.7.0-rc.0>v2.7.0 release candidate</a> with OCI v1 image support. We expect after final release that registries based on the open source distribution, including DockerHub, will update in the near future to adopt these new features. At that point, client tools which today already support the OCI image formats will have interoperability with these registries thanks to the hard work of many involved from Docker, to the OCI, to participating vendors and contributors.</p><p>In addition to the growing adoption of the OCI v1 image formats—used natively in other projects like the CNCF containerd project as well as the Moby project’s LinuxKit implementation—we’re also excited about the standardization of the registry API itself coming to OCI this year. The proposal to take the Docker HTTP registry API has already been <a href=https://github.com/opencontainers/distribution-spec>accepted into the OCI</a>. This specification will add industry standardization around the protocol to talk to registries in addition to the existing interoperability brought in with the OCI v1 image specification.</p><p>It’s great to see growing adoption of the OCI specifications, and with the added support in the open source Docker registry for OCI images, we see this as just the beginning of a whole host of tools, vendor products, and software that will be enabled to utilize the OCI specifications now and in the future.</p></div></article></main><footer class="container flex grid self-center grid-cols-12 p-4 md:w-full"><p class="col-span-12 lg:col-span-4">Copyright © 2020 The Linux Foundation®. All rights reserved.
The Linux Foundation has registered trademarks and uses trademarks.
For a list of trademarks of The Linux Foundation, please see our <a href=https://www.linuxfoundation.org/trademark-usage target=_blank>Trademark Usage</a> page.
Linux is a registered trademark of Linus Torvalds. <a href=https://www.linuxfoundation.org/trademark-usage target=_blank>Privacy Policy</a> and <a href=https://www.linuxfoundation.org/terms target=_blank>Terms of Use</a></p></footer><script type=module src=https://unpkg.com/ionicons@5.0.0/dist/ionicons/ionicons.esm.js></script><script nomodule src=https://unpkg.com/ionicons@5.0.0/dist/ionicons/ionicons.js></script></body></html>