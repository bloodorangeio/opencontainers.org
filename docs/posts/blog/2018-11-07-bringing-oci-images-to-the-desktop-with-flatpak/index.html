<!doctype html><html><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Bringing OCI images to the desktop with Flatpak - Open Container Initiative</title><meta name=author content="map[name:Open Container Initiative tag:oci]"><link href="https://fonts.googleapis.com/css2?family=Lekton:ital,wght@0,400;0,700;1,400&family=Open+Sans:ital,wght@0,400;0,700;1,400;1,700&display=swap" rel=stylesheet><link rel=stylesheet href=/css/styles.min.338fe0dbba89c3f6977ce2d01697f804f1e072d930d628d7ecb4e790232b7c15.css integrity="sha256-M4/g27qJw/aXfOLQFpf4BPHgctkw1ijX7LTnkCMrfBU="><meta name=generator content="Hugo 0.74.1"></head><body class="flex flex-col min-h-screen bg-lightgray"><header class="sticky top-0 w-full header-shadow"><div class="flex justify-left bg-darkgray"><div class="flex p-1"><a href=https://www.linuxfoundation.org/projects target=_blank><img src=/img/logos/logo_lf_projects.svg class=h-4></a></div></div><nav class="flex flex-wrap items-center justify-between bg-white xs:flex-col sm:flex-col md:flex-col lg:flex-row"><div class="flex-none p-1 md:items-center sm:w-auto md:w-auto"><a href=https://opencontainers.org/ class="flex items-center"><img src=/img/logos/OCI-logo.svg class=h-10></a></div><nav class="flex flex-wrap items-center justify-between pr-5 sm:w-auto md:w-auto"><input id=nav-toggle type=checkbox class=hidden>
<label id=show-button for=nav-toggle class="flex items-center block text-gray-500 sm:hidden hover:text-blue-500"><svg class="w-4 h-4 fill-current" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><title>Menu Open</title><path d="M0 3h20v2H0V3zm0 6h20v2H0V9zm0 6h20v2H0V0z"/></svg></label><label id=hide-button for=nav-toggle class="flex items-center hidden p-2 text-gray-700 hover:text-blue-500"><svg class="w-4 h-4 fill-current" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><title>Menu Close</title><polygon points="11 9 22 9 22 11 11 11 11 22 9 22 9 11 -2 11 -2 9 9 9 9 -2 11 -2" transform="rotate(45 10 10)"/></svg></label><ul id=nav-menu class="items-center justify-end flex-grow hidden w-full mt-2 md:flex-row sm:flex-row sm:flex sm:w-auto sm:block list-reset sm:mt-0"><li class="parent-menu-item sm:self-start"><a class="inline-block text-gray-500 sm:px-2 hover:text-lightpurple lekton navbar-item" href=#>About
<ion-icon name=chevron-down-sharp class=align-middle></ion-icon></a><div class="p-2 child-menu"><ul><li><a class="inline-block text-gray-500 sm:px-2 hover:text-lightpurple lekton navbar-item" href=/about/overview>About the OCI</a></li><li><a class="inline-block text-gray-500 sm:px-2 hover:text-lightpurple lekton navbar-item" href=https://github.com/opencontainers/tob/blob/master/CHARTER.md target=_blank>Governance
<ion-icon name=trending-up-sharp title="external link"></ion-icon></a></li><li><a class="inline-block text-gray-500 sm:px-2 hover:text-lightpurple lekton navbar-item" href=https://github.com/opencontainers/.github/blob/master/CODE_OF_CONDUCT.md target=_blank>Code of conduct
<ion-icon name=trending-up-sharp title="external link"></ion-icon></a></li><li><a class="inline-block text-gray-500 sm:px-2 hover:text-lightpurple lekton navbar-item" href=/about/tob>Leadership</a></li><li><a class="inline-block text-gray-500 sm:px-2 hover:text-lightpurple lekton navbar-item" href=/about/security-disclosure>Security disclosure</a></li></ul></div></li><li class="parent-menu-item sm:self-start"><a class="inline-block text-gray-500 sm:px-2 hover:text-lightpurple lekton navbar-item" href=#>Specs
<ion-icon name=chevron-down-sharp class=align-middle></ion-icon></a><div class="p-2 child-menu"><ul><li><a class="inline-block text-gray-500 sm:px-2 hover:text-lightpurple lekton navbar-item" href=/specs/distribution-spec/>Distribution spec</a></li></ul></div></li><li class="parent-menu-item sm:self-start"><a class="inline-block text-gray-500 sm:px-2 hover:text-lightpurple lekton navbar-item" href=#>Community
<ion-icon name=chevron-down-sharp class=align-middle></ion-icon></a><div class="p-2 child-menu"><ul><li><a class="inline-block text-gray-500 sm:px-2 hover:text-lightpurple lekton navbar-item" href=/community/overview>Overview</a></li><li><a class="inline-block text-gray-500 sm:px-2 hover:text-lightpurple lekton navbar-item" href=/community/certified>Certification program</a></li></ul></div></li><li class="parent-menu-item sm:self-start"><a class="inline-block text-gray-500 sm:px-2 hover:text-lightpurple lekton navbar-item" href=/join>Join</a></li><li class="parent-menu-item sm:self-start"><a class="inline-block text-gray-500 sm:px-2 hover:text-lightpurple lekton navbar-item" href=/posts/blog>Blog</a></li><li class="parent-menu-item sm:self-start"><a class="inline-block text-gray-500 sm:px-2 hover:text-lightpurple lekton navbar-item" href=#>News
<ion-icon name=chevron-down-sharp class=align-middle></ion-icon></a><div class="p-2 child-menu"><ul><li><a class="inline-block text-gray-500 sm:px-2 hover:text-lightpurple lekton navbar-item" href=/posts/announcements/>Announcements</a></li><li><a class="inline-block text-gray-500 sm:px-2 hover:text-lightpurple lekton navbar-item" href=/posts/news/>In the news</a></li></ul></div></li><li class="parent-menu-item sm:self-start"><a class="inline-block text-gray-500 sm:px-2 hover:text-lightpurple lekton navbar-item" href=/faq>FAQ</a></li><li class="parent-menu-item sm:self-start"><a class="inline-block text-gray-500 sm:px-2 hover:text-lightpurple lekton navbar-item" href=/release-notices>Release notices</a></li><li class="parent-menu-item sm:self-start"><a class="inline-block text-gray-500 sm:px-2 hover:text-lightpurple lekton navbar-item" href=/contact>Contact us</a></li><li class="parent-menu-item sm:self-start"><a href=https://twitter.com/OCI_ORG class=p-2 target=_blank title="follow us on Twitter"><ion-icon name=logo-twitter class=pt-1></ion-icon></a></li></ul></nav></nav></header><main class="container mx-auto"><article class="mt-20 mb-10"><div class="px-10 pt-10 pb-5 single-header"><h1 class="text-3xl font-bold">Bringing OCI images to the desktop with Flatpak</h1><p class="pb-5 meta">Wednesday, November 7, 2018 by Open Container Initiative</p><div id=sharing><a href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fopencontainers.org%2fposts%2fblog%2f2018-11-07-bringing-oci-images-to-the-desktop-with-flatpak%2f" class=pl-1 aria-label="share on Facebook"><ion-icon name=logo-facebook></ion-icon></a><a href="http://twitter.com/share?url=https%3a%2f%2fopencontainers.org%2fposts%2fblog%2f2018-11-07-bringing-oci-images-to-the-desktop-with-flatpak%2f&text=Bringing%20OCI%20images%20to%20the%20desktop%20with%20Flatpak&via=" class=pl-1 aria-label="share on Twitter"><ion-icon name=logo-twitter></ion-icon></a><a href="http://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fopencontainers.org%2fposts%2fblog%2f2018-11-07-bringing-oci-images-to-the-desktop-with-flatpak%2f&title=Bringing%20OCI%20images%20to%20the%20desktop%20with%20Flatpak" onclick="window.open('http://www.linkedin.com/shareArticle?mini=true&url='+encodeURIComponent(document.URL)+'&title='+encodeURIComponent(document.title));return false;" class=pl-1 aria-label="share on LinkedIn"><ion-icon name=logo-linkedin></ion-icon></a></div></div><div class="px-32 py-24 bg-white content"><p>By Alex Larsson and Owen Taylor</p><p>Over the last five years, containers have taken the server world by storm. Many of the same things that make containers well-suited for server-side computing — the ability to test code an environment that is very similar to the deployment environment, the ability to upgrade application software independently from the host operating system, the ability to deploy applications across multiple host operating systems — also make a lot of sense for desktop applications.</p><p>At the same time that container technologies were emerging on the server, the <a href=https://github.com/flatpak/flatpak/>Flatpak project</a> was <a href=https://blogs.gnome.org/alexl/2018/06/20/flatpak-a-history/>being developed</a> by a community of contributors, including engineers from Red Hat, Collabora, and Endless Mobile, as a way to improve application deployment on desktop Linux, and allow application authors to make their applications available directly to users. During the evolution of Flatpak, leading up to a 1.0 release in August 2018, it’s been possible to share technologies with server-side containers, from namespaces, to seccomp, to the OCI Image format.</p><h2 id=containers-for-the-desktop>Containers for the Desktop
<a class=headline-hash href=#containers-for-the-desktop><span class="icon hashlink"><ion-icon name=link-sharp class=align-middle></ion-icon></span></a></h2><p>You might wonder if it would have been possible to go one step further and use a existing server-side <a href=https://developers.redhat.com/blog/2018/02/22/container-terminology-practical-introduction/#h.6yt1ex5wfo55>runtime</a>, such as <a href=https://github.com/opencontainers/runc>runc</a>, to run containers on the desktop. While it is possible to use server containers for desktop applications and get basic functionality working, the desktop world is pretty different from the server world. Instead of integrating with storage-area-networks, network routing, and orchestration, a desktop application deals with USB input devices, geolocation, and desktop environment application menus. Server-side technology might have the ability to provide access to a device, or block it off, but can’t meaningfully handle interactively working with the user to establish fine-grained access control.</p><p>For this reason, Flatpak doesn’t use runc, but instead has its own runtime that runs within the user’s desktop session and provides services (called portals) that allow applications to access the desktop under the user’s control. A portal is a service, exposed via the D-Bus IPC protocol, that sits between the application and the resource the application wants to access (local files, printing, geolocation, etc.) and provides a user interface to let the user decide whether to allow access or not. Typically this is not done as a Yes/No question about permissions but instead as a natural part of the operation. For example, instead of asking a user “Allow application X to access your files?”, the user is shown a file selection dialog, and they can either pick a file to pass back to the application, or they can cancel the operation.</p><p>In addition to a unique desktop-focused security model, Flatpak has an approach to combining operating system and application content into a single container that was inspired by the requirements of the desktop. The typical model for a server container is that a base image is arbitrarily modified to create the application container. Each application container is its own mini-operating system, and in order to fix a bug or security hole in the base operating system, the application has to be rebuilt and deployed. The OCI layer system potentially optimizes the deployment step, but the rebuilds are still necessary, and production images are often “squashed” for maximum efficiency.</p><p>The downsides of having every application independent are minimized in the server environment: we usually have a small number of applications running on a node with abundant disk space and network bandwidth, and hopefully have automation to automatically rebuild applications as necessary, as well as paid sysadmins. On a desktop, we might instead have dozens or hundreds of applications installed on a much more modest device, maintained by individual users. We also don’t want software vendors to have to rebuild their application in order to pick up a fix to the base operating system.</p><p>For this reason, when a Flatpak application is executed, two separate filesystems are mounted in its environment – the runtime filesystem is mounted at the path /usr, and the application filesystem is mounted at /app. Library and other search paths in the applications execution environment are set up to search both directories so that code and resources can be bundled with the runtime or with the application. This way a single runtime can be reused by many applications, and can be updated without having to modify applications. Different applications can use different runtimes, so some applications might use a runtime that is maintained for long-term stability with few changes, and other applications might use a runtime that gets more rapid releases to pick up new library versions.</p><h2 id=flatpaks-as-oci-images>Flatpaks as OCI Images
<a class=headline-hash href=#flatpaks-as-oci-images><span class="icon hashlink"><ion-icon name=link-sharp class=align-middle></ion-icon></span></a></h2><p>The native image format for Flatpaks is OSTree. It is a local storage format that automatically supports deduplication and versioning. It also naturally comes with a distribution framework, which most Flatpak repositories use. However, that is not the only distribution mechanism Flatpak supports.</p><p>Organizations seldom deploy only servers or only desktops. Having a unified way to distribute desktop applications and server applications can be highly desirable for sysadmins: they don’t really want to maintain both an OSTree repository, and a OCI registry (for servers). Luckily, the OCI format is sufficiently flexible that it is also suitable for storing desktop applications. Flatpak supports installing applications and runtimes from OCI images and a Flatpak remote can either be an ostree repository or a tentative version of the <a href=https://github.com/opencontainers/distribution-spec>OCI registry</a> (distribution spec). At the end-user level the difference is invisible and all available sources of applications are integrated together and displayed to the user.</p><p>One of the basic advantages that the OCI Image format has over older image formats is the concept of annotations – in addition to a compressed filesystem and standard metadata such as the operating system, architecture, and author of the image, an OCI Image provides a set of arbitrary key/value pairs. When we’re storing a Flatpak as an OCI image, these annotations are used to store information like the permissions that the Flatpak requires and its installed size.</p><p>One thing that is still actively under development is browsing available Flatpaks. Typing ‘docker pull postgresql:latest’ may be a good user interface for the server command line, but a desktop user typically wants a nice user interface with icons, human readable names, and a user-friendly description. These things can be stored in the OCI annotations of the individual images, but it’s also necessary to be able to efficiently download the information for all the images in the registry, without having to download each individual image. Currently, Flatpak supports a <a href=https://github.com/owtaylor/flagstate/blob/master/docs/protocol.md>draft metadata format and protocol</a> for this. The <a href=https://github.com/owtaylor/flagstate/>Flagstate</a> server allows adding this capability to an existing registry. Browsing and searching available images in a registry is useful beyond the desktop, so perhaps this is something that future versions of the OCI distribution specification can address.</p><p>As Flatpaks become more commonly used as a way to distribute desktop applications, users can benefit from an expanded set of available applications, with more robust upgrades and enhanced security. Using OCI Images and the OCI distribution mechanism as a deployment technology enables sysadmins to have a unified way of managing and distributing server side and desktop applications within their organization.</p><p>Hundreds of applications from Inkscape and Blender, to LibreOffice, to SuperTuxKart, are already available as Flatpaks. Flatpak is installed by default on current versions of some Linux distributions and can be easy to install on most others. <a href=https://flatpak.org/setup/>Instructions for getting started</a> can be found on flatpak.org.</p><hr><p>Alex Larsson is a Senior Principal Software Engineer at Red Hat and the creator of Flatpak.</p><p>Owen Taylor is a Principal Software Engineer at Red Hat, and architect for Red Hat’s desktop and workstation engineering team.</p></div></article></main><footer class="container flex grid self-center grid-cols-12 p-4 md:w-full"><p class="col-span-12 lg:col-span-4">Copyright © 2020 The Linux Foundation®. All rights reserved.
The Linux Foundation has registered trademarks and uses trademarks.
For a list of trademarks of The Linux Foundation, please see our <a href=https://www.linuxfoundation.org/trademark-usage target=_blank>Trademark Usage</a> page.
Linux is a registered trademark of Linus Torvalds. <a href=https://www.linuxfoundation.org/trademark-usage target=_blank>Privacy Policy</a> and <a href=https://www.linuxfoundation.org/terms target=_blank>Terms of Use</a></p></footer><script type=module src=https://unpkg.com/ionicons@5.0.0/dist/ionicons/ionicons.esm.js></script><script nomodule src=https://unpkg.com/ionicons@5.0.0/dist/ionicons/ionicons.js></script></body></html>